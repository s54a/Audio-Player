<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="shortcut icon"
      href="https://www.svgrepo.com/show/268463/music-player-music.svg"
      type="image/x-icon"
    />
    <title>Loop Player</title>
    <script type="module" crossorigin>(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const g of l.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&s(g)}).observe(document,{childList:!0,subtree:!0});function r(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(n){if(n.ep)return;n.ep=!0;const l=r(n);fetch(n.href,l)}})();const a=document.getElementById("urlInput"),L=document.getElementById("playButton"),t=document.getElementById("audioPlayer"),p=document.getElementById("errorMessage"),E=document.getElementById("upload-zone"),h=document.getElementById("file-input"),c=document.getElementById("file-list"),f=localStorage.getItem("audioUrl"),k=localStorage.getItem("audioTime"),b=1e3,y=50;let v=null;window.addEventListener("DOMContentLoaded",()=>{f&&(a.value=f,t.src=f,t.loop=!0,t.addEventListener("loadedmetadata",()=>{k&&(t.currentTime=parseFloat(k))}))});t.addEventListener("timeupdate",()=>{localStorage.setItem("audioTime",t.currentTime)});let d,u=[],i=-1;const I=indexedDB.open("audioLibrary",1);I.onupgradeneeded=e=>{d=e.target.result,d.objectStoreNames.contains("files")||d.createObjectStore("files",{keyPath:"name"})};I.onsuccess=e=>{d=e.target.result,D()};E.addEventListener("click",()=>h.click());E.addEventListener("dragover",e=>e.preventDefault());E.addEventListener("drop",e=>{e.preventDefault(),T(e.dataTransfer.files)});h.addEventListener("change",()=>T(h.files));function T(e){const o=Array.from(e).filter(r=>r.type.includes("audio")||r.name.toLowerCase().endsWith(".mp3"));C(o)}function C(e){const o=d.transaction("files","readwrite"),r=o.objectStore("files");e.forEach(s=>{const n={name:s.name,file:s,path:s.webkitRelativePath||s.name};r.put(n)}),o.oncomplete=()=>{D()}}function D(){const o=d.transaction("files","readonly").objectStore("files");u=[],o.openCursor().onsuccess=r=>{const s=r.target.result;s?(u.push(s.value),s.continue()):m()}}a.addEventListener("input",()=>{const e=a.value.toLowerCase();m(e)});function m(e=""){c.innerHTML="";const o=u.filter(r=>r.path.toLowerCase().includes(e));o.length>0?(c.style.display="block",o.forEach((r,s)=>{const n=document.createElement("li");n.textContent=r.path,n.onclick=()=>F(s,r),s===i&&n.classList.add("selected"),c.appendChild(n)})):c.style.display="none"}function F(e,o){i=e,a.value=o.path,m();const r=URL.createObjectURL(o.file);w(r)}function U(e){const o=b/y,r=t.volume/o,s=()=>{t.volume>r?(t.volume-=r,v=setTimeout(s,y)):(t.volume=0,e&&e())};s()}function A(){const r=1/(b/y),s=()=>{t.volume<1-r?(t.volume+=r,v=setTimeout(s,y)):t.volume=1};s()}async function w(e){v&&clearTimeout(v),t.paused||await new Promise(o=>{U(()=>{t.pause(),o()})}),t.volume=0,localStorage.removeItem("audioTime"),t.src=e,t.loop=!0,t.addEventListener("loadedmetadata",()=>{t.currentTime=0,t.play().then(()=>{A()}).catch(o=>{p.style.display="block",p.textContent=`Error playing audio: ${o.message}`})})}L.addEventListener("click",()=>{const e=a.value.trim();if(!e){p.textContent="Please enter a URL";return}localStorage.setItem("audioUrl",e),w(e)});document.addEventListener("keydown",e=>{if(e.key==="Enter"&&document.activeElement===a){if(e.preventDefault(),i>=0){const o=u[i];F(i,o)}else{const o=a.value.trim();o.startsWith("http")&&w(o)}a.blur()}else e.key==="ArrowUp"&&c.style.display==="block"?(e.preventDefault(),i=Math.max(0,i-1),m(a.value.toLowerCase())):e.key==="ArrowDown"&&c.style.display==="block"&&(e.preventDefault(),i=Math.min(u.length-1,i+1),m(a.value.toLowerCase()))});a.addEventListener("keydown",e=>{e.key==="Enter"&&(L.click(),a.blur()),e.ctrlKey&&e.key==="v"&&setTimeout(()=>{L.click(),a.blur()},100)});t.addEventListener("error",e=>{p.textContent="Unable to load or play the audio file. Check the URL and file access."});document.addEventListener("keydown",e=>{e.key==="/"?(e.preventDefault(),a.focus(),a.value=""):e.key==="Escape"?(a.blur(),a.value=f):e.code==="Space"&&document.activeElement!==a&&(e.preventDefault(),t.paused?(t.volume=0,t.play().then(()=>A())):U(()=>t.pause()))});document.addEventListener("keydown",e=>{e.key==="ArrowUp"?t.volume=Math.min(t.volume+.1,1):e.key==="ArrowDown"?t.volume=Math.max(t.volume-.1,0):e.key==="ArrowRight"?t.currentTime=Math.min(t.currentTime+2.5,t.duration):e.key==="ArrowLeft"&&(t.currentTime=Math.max(t.currentTime-2.5,0))});document.addEventListener("click",e=>{!c.contains(e.target)&&e.target!==a&&(c.style.display="none")});a.addEventListener("focus",()=>{u.length>0&&m(a.value.toLowerCase())});</script>
    <style rel="stylesheet" crossorigin>:root{--background-color: #f0f0f0;--text-color: #121212;--input-background: #ffffff;--input-border: #ccc;--button-background: #007fff;--button-hover: #198cff;--audio-controls-bg: #ccc;--gradient-light: linear-gradient(to right, #f5af19, #f12711);--gradient-dark: linear-gradient(to right, #070712, #0d0d1a, #020106)}@media (prefers-color-scheme: dark){:root{--background-color: #121212;--text-color: #e0e0e0;--input-background: #1e1e1e;--input-border: #333;--audio-controls-bg: #999}}html::-webkit-scrollbar{width:0}body{font-family:Arial,sans-serif;max-width:1000px;margin:0 auto;padding:20px;text-align:center;background:var(--gradient-light)}@media (prefers-color-scheme: dark){body{background:var(--gradient-dark)}}#urlInput{width:100%;padding:10px;margin:10px 0 20px;height:54px;box-sizing:border-box;background-color:var(--input-background);border:1px solid var(--input-border);color:var(--text-color);border-radius:10px;outline:none;font-size:1rem}#playButton{display:none}#audioPlayer{margin-top:20px;width:100%}#errorMessage{color:#ff6b6b;margin-top:10px;display:none}h1{color:var(--text-color)}.container{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:20px;width:1000px;box-sizing:border-box;transition:opacity .5s ease,visibility .5s ease;visibility:hidden;opacity:0}.parent-container:hover .container{opacity:1;visibility:visible}audio::-webkit-media-controls-enclosure{background-color:var(--audio-controls-bg);border-radius:10px}#upload-zone{border:2px dashed var(--input-border);padding:20px;text-align:center;margin-bottom:20px;cursor:pointer;border-radius:10px;background-color:var(--input-background);color:var(--text-color);transition:all .3s ease}#upload-zone:hover{border-color:var(--button-background);background-color:#007fff1a}#file-list{list-style:none;padding:0;margin-top:20px;max-height:300px;overflow-y:auto;width:100%;background-color:var(--input-background);border-radius:10px;display:none}#file-list li{padding:10px;color:var(--text-color);border-bottom:1px solid var(--input-border);cursor:pointer;transition:background-color .3s ease}#file-list li:hover{background-color:#007fff1a}#file-list li.selected{background-color:#007fff33}</style>
  </head>
  <body>
    <div class="parent-container">
      <div class="container">
        <div id="upload-zone">
          Drop audio files or folder here or click to upload
        </div>
        <input
          type="file"
          id="file-input"
          multiple
          webkitdirectory
          style="display: none"
        />
        <input
          type="text"
          id="urlInput"
          placeholder="Enter audio file URL or search stored tracks"
        />
        <button id="playButton">Play</button>
        <div id="errorMessage"></div>
        <ul id="file-list"></ul>
        <audio id="audioPlayer" controls loop></audio>
      </div>
    </div>
  </body>
</html>
